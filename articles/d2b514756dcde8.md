---
title: "気になっていた shell を触る"
emoji: "🐚"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: ["shell", "zx", "oils", "nushell"]
published: false
---

この記事は [2026年!初アウトプットをしよう](https://qiita.com/official-events/db2106c2a38d86187ffc) に向けて書いた記事です。
Qiita, Zenn の両方に投稿しています。

数年くらい気になっていた Shell をいくつか触ってみることにしました。
普段は Bash, Zsh を使っていますが、いろいろを考えて最近は Bash に固定しつつあります。

最近、新しいことを学んでいないなと思ったこともあり、AI Agent の力(ClaudeCode)を借りて環境構築してみて、いくつか考えてみることにしました。

なお今回の調査では実運用に乗せるというより、自分の興味の範囲でどういう利点があるのかを見定めて見るために書いているので、実用性についてはあまり考えていません。

## 試したもの

- [zx](https://github.com/google/zx)
    - 自分で環境構築したもの [my-playground-zx](https://github.com/yumechi/my-playground-zx)
- [oils](https://github.com/oils-for-unix/oils)
    - 自分で環境構築したもの [my-playground-oils](https://github.com/yumechi/my-playground-oils)
- [nushell](https://github.com/nushell/nushell)
    - 自分で環境構築したもの [my-playground-nushell](https://github.com/yumechi/my-playground-nushell)

## 選定理由など

以前、Bash, Zsh の微妙な動きの違いやディストリビューションによる微妙な違い（主にMac絡みなんですが…）があり、そういったものをあまり意識しないでも使える Shell がないかを考えていました。

当時たどり着いたのが、zs, oils(当時は oil という名前だった)でした。
こういったもので統一的にツールが使えると嬉しいよなーと思いつつ、当時から調査を放置していました。当時とは5年以上前のことなんですが…。

nushell は最近知って興味が出たので触ってみました。
[xonsh](https://github.com/xonsh/xonsh) も気になっていましたが（記事の執筆に間に合わないような気がしてきたので）、今回は見送りました。気が向いたときにやります。

後はこれらのツールを見ていると、それなりに GitHub の Star もされていることから、一定の利用者がいて良さそうな印象を受けていました。
なぜこれらのツールを使うのか？ そういったところも含めて考えてみたかったというのが同期となります。

## zx
### 概要

[zx](https://github.com/google/zx) は Google が開発した JavaScript/TypeScript 用のシェルスクリプティングライブラリです。シェルコマンドを JavaScript のテンプレートリテラル構文（`$`プレフィックス付きバッククォート）で直感的に実行でき、シェルスクリプトの手軽さと JavaScript の柔軟性を両立させることを目指しています。

Node.js の `child_process` を内部で使用していますが、開発者はそれを意識せず、まるで Bash でコマンドを実行しているかのように記述できます。

### 特徴

**1. テンプレートリテラルによるコマンド実行**

```javascript
const result = await $`ls -la`;
const branch = await $`git branch --show-current`;
```

変数の埋め込みも自然に行えます。

**2. async/await による非同期処理**

すべてのコマンドが Promise ベースで実行されるため、非同期処理を同期的に見えるコードで記述できます。`Promise.all` や `Promise.allSettled` を使った並行処理も簡単です。

**3. ユーザー対話機能**

`question` 関数でユーザー入力を対話的に取得できます。選択肢の提示や確認プロンプト（y/n）など、インタラクティブなスクリプトを構築できます。

```javascript
const name = await question('What is your name? ');
const choice = await question('Choose: ', { choices: ['A', 'B', 'C'] });
```

**4. spinner による進捗表示**

処理中のローディング表示を簡単に実装できます。

**5. TypeScript サポート**

型安全なスクリプト開発が可能で、IDE の補完やエラーチェックの恩恵を受けられます。

**6. JavaScript エコシステムとの統合**

npm パッケージを自由に使えるため、`chalk` での色付き出力、JSON のネイティブ処理、配列操作など、JavaScript の強力な機能をシェルスクリプト内で活用できます。HTTP リクエストの並行実行なども容易です。

[プレイグラウンドリポジトリ](https://github.com/yumechi/my-playground-zx)では、これらの機能を活用したデモスクリプトを用意しています

### 実際試してみて

人間が書く

## oils
### 概要

[Oils](https://github.com/oils-for-unix/oils) は、Unix シェルの改良を目指すプロジェクトで、単一のバイナリ（oils-for-unix）から **OSH** と **YSH** という2つのシェルを提供しています。シンボリックリンクによって起動時にどちらのシェルとして動作するかが切り替わります。

**OSH（Oil Shell - 互換モード）**
Bash/POSIX シェルとの互換性を保ちながら、より厳密なエラーハンドリングと安全性を提供するシェルです。既存のシェルスクリプトをほぼそのまま実行でき、段階的な移行が可能です。

**YSH（Oil Shell - 新言語モード）**
「シェル + Python + Regex + JSON + YAML を統合した究極のグルー言語」をコンセプトとした、モダンな構文を持つ新しいシェル言語です。Python や JavaScript に馴染みのある開発者をターゲットにしています。

### 特徴

#### OSH の特徴

**1. 強化された Strict Mode**

OSH は `set -o errexit`、`pipefail`、`nounset` をより確実に実装しています。Bash では見落とされがちなエラーを検出できます。

```bash
set -o errexit
set -o pipefail
set -o nounset
```

**2. command_sub_errexit オプション**

Bash が `$(false)` のようなコマンド置換の失敗を見落とす問題を、OSH ではこのオプションで検出可能にしています。

**3. 静的パース**

スクリプト全体を実行前に単一パスで解析するため、実行されないコード内のエラーも事前に検出できます。Bash の動的パースの限界を克服しています。

**4. sigpipe_status_ok オプション**

`yes | head` のようなコマンドでの SIGPIPE を適切に処理し、不要な失敗判定を防ぎます。

#### YSH の特徴

**1. モダンな変数宣言**

```ysh
var name = "Alice"
const PI = 3.14159
```

**2. 型付きデータ構造（リストと辞書）**

Python/JavaScript 風の構文でリストと辞書を扱えます。

```ysh
var colors = ['red', 'green', 'blue']
var person = {name: 'Bob', age: 30}
```

**3. Eggex（読みやすい正規表現）**

従来の複雑な正規表現を直感的に表現できます。

```ysh
var pattern = / digit{1,3} '.' digit{1,3} /
```

**4. proc と func の区別**

`proc` は副作用のある処理、`func` は純粋関数として区別します。

**5. 式言語**

`$[x + y]` で計算結果を文字列に埋め込めます。

**6. 文字列メソッド**

`.trim()`、`.upper()`、`.split()` など、オブジェクト指向的な文字列操作が可能です。

**7. JSON ネイティブサポート**

辞書と JSON 間の相互変換が組み込みでサポートされています。

[プレイグラウンドリポジトリ](https://github.com/yumechi/my-playground-oils)では、OSH と YSH それぞれの特徴的なスクリプトを用意しています

### 実際試してみて

人間が書く

## nushell
### 概要

[Nushell](https://github.com/nushell/nushell) は「新しいタイプのシェル」として開発されている、構造化データ処理に特化したモダンシェルです。Rust で実装されており、従来のシェルがテキストストリームを扱うのに対し、Nushell は**すべてのデータを構造化されたテーブル**として扱います。

PowerShell の影響を受けつつも、クロスプラットフォームで動作し、SQL ライクな構文でデータを操作できることが大きな特徴です。

### 特徴

**1. 構造化データのネイティブサポート**

`ls` の出力も単なるテキストではなく、列（name, size, modified など）を持つテーブルとして返されます。これにより、`awk` や `sed` を使わずに直感的なデータ操作が可能です。

```nushell
ls | where size > 1kb | sort-by modified
```

**2. SQL ライクなパイプライン処理**

`where`（フィルタリング）、`select`（列選択）、`sort-by`（ソート）、`group-by`（グループ化）など、SQL に似た宣言的な構文でデータを変換・集計できます。

```nushell
$data | where age > 25 | select name department | sort-by name
```

**3. JSON/CSV のネイティブ処理**

JSON や CSV を外部ツール（`jq` など）なしで直接操作できます。ファイルを読み込むとそのまま構造化データとして扱えます。

```nushell
open data.json | where status == "active" | to csv
```

**4. 組み込み数学関数**

`math sum`、`math avg`、`math max` などの統計関数が組み込まれており、データ分析が簡単です。

```nushell
$sales | get amount | math sum
```

**5. カスタム関数の定義**

```nushell
def rating-to-score [rating: string] -> int {
    match $rating {
        "excellent" => 5
        "good" => 4
        "average" => 3
        _ => 2
    }
}
```

**6. 豊富なデータ変換**

`insert`（列追加）、`update`（列更新）、`rename`（列名変更）、`flatten`（ネスト解除）など、データ変換のための多彩なコマンドが用意されています。

**7. 見やすいテーブル出力**

出力は自動的に整形されたテーブル形式で表示され、ターミナル上での可読性が高いです。

[プレイグラウンドリポジトリ](https://github.com/yumechi/my-playground-nushell)では、JSON 処理、CSV 分析、データパイプラインなど、Nushell の特徴を活かした様々なサンプルスクリプトを用意しています

### 実際試してみて

人間が書く

## いろいろ試してみて

人間が書く

