---
title: "Github Actionsã§Pull Requestã‚’ãƒãƒ¼ã‚¸ã—ãŸã¨ãã«è‡ªå‹•çš„ã«ãƒªãƒªãƒ¼ã‚¹ãƒãƒ¼ãƒˆä½œæˆãƒ»ã‚¿ã‚°ä»˜ã‘ã—ãŸã„"
emoji: "ğŸ˜º"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["githubactions"]
published: true
---

PR ã‚’ä½œæˆã—ã¦ main(ã¾ãŸã¯ master) ã«ãƒãƒ¼ã‚¸ã—ãŸéš›ã«ã€è‡ªå‹•çš„ã«ã‚¿ã‚°ä»˜ã‘ã™ã‚‹ä»•çµ„ã¿ã«ã¤ã„ã¦è€ƒãˆã¦ã„ã¾ã—ãŸã€‚

ã“ã“ã§ã¯æ‰‹å‹•ã§ main ã«ãƒãƒ¼ã‚¸ã•ã‚Œã‚‹ã“ã¨ã‚’æƒ³å®šã—ã¦ã€ãƒªãƒªãƒ¼ã‚¹ãƒãƒ¼ãƒˆã®ä½œæˆã¨ã‚¿ã‚°ä»˜ã‘ã‚’ã—ã¾ã™ã€‚

äºŒç•ªç…ã˜ã®å¯èƒ½æ€§ã‚‚ã‚ã‚Šã¾ã™ãŒã€æ›¸ãèµ·ã“ã—ã¦ãŠãã¾ã™ã€‚
ã¾ãŸã€ã‚µãƒ¼ãƒ‰ãƒ‘ãƒ¼ãƒ†ã‚£ã®ã‚‚ã®ã«ãªã‚‹ã¹ãé ¼ã‚‰ãšå®Ÿç¾ã§ããªã„ã‹ã‚’æ¤œè¨ã—ã¾ã™ã€‚

## å‡ºæ¥ãŸã‚‚ã®

https://github.com/yumechi/github-actions-add-tag

## ä½œã£ãŸaction

```yml
name: My Workflow

on:
  pull_request:
    branches:
      - main
      - master
    types:
      - closed

jobs:
  build:
    if: github.event.pull_request.merged == true
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v3

      - name: Extract PR Comment
        id: pr_comment
        run: |
          TAG=$(echo "$PULL_REQUEST_BODY" | grep -Po '(?<=tag: )v\d+\.\d+\.\d+')
          if [ -n "$TAG" ]; then
            gh release create $TAG --generate-notes
          fi
        env:
          GITHUB_TOKEN: "${{ secrets.GH_TOKEN }}"
          PULL_REQUEST_BODY: "${{ github.event.pull_request.body }}"
```

## æƒ³å®šã•ã‚Œã‚‹PR

PR ã®ãƒœãƒ‡ã‚£ã«ã‚¿ã‚°åãŒå…¥ã£ã¦ã„ã‚‹ã“ã¨ã‚’æƒ³å®šã—ã¦ã„ã¾ã™ã€‚è¤‡æ•°å…¥ã£ã¦ã„ã‚‹å ´åˆã¯ã©ã†å‹•ãã‹çŸ¥ã‚Šã¾ã›ã‚“ã€‚

ä»¥ä¸‹ãŒã‚µãƒ³ãƒ—ãƒ«ã«ãªã‚Šã¾ã™ã€‚

```markdown
ãƒ—ãƒ«ãƒªã‚¯ä½œæˆ

tag: v1.0.0

å¤‰æ›´ç®‡æ‰€ã¯ä»¥ä¸Šã§ã™
```

## ä½•ã‚’ã—ãŸã‹ï¼Ÿ
### pull request ãŒãƒãƒ¼ã‚¸ã•ã‚ŒãŸã¨ãã®ã¿å‹•ã‹ã™

å…¸å‹çš„ãªå¯¾å¿œãªã®ã§å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã«è¼‰ã£ã¦ã„ã¾ã™ã€‚ã“ã‚Œã‚’å‚è€ƒã«ã—ã¾ã—ãŸã€‚

https://docs.github.com/en/actions/using-workflows/events-that-trigger-workflows#running-your-pull_request-workflow-when-a-pull-request-merges

### ã‚¿ã‚°æƒ…å ±ã‚’å–ã‚Šå‡ºã™

ä»Šå›ã¯ grep ã§é ‘å¼µã£ã¦å–ã‚Šå‡ºã—ã¾ã™ã€‚
PR ã®ãƒœãƒ‡ã‚£ã®æƒ…å ±ã¯ `github.event.pull_request.body` ã§å–ã‚Šå‡ºã›ã¾ã™ãŒã€ä»Šå›ã¯ç’°å¢ƒå¤‰æ•°ã®å½¢ã§æ¸¡ã™ã‚ˆã†ã«ã—ã¾ã—ãŸã€‚

### GitHub CLI ã‚’å‹•ã‹ã™

ã“ã¡ã‚‰ã‚‚å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã«ä¹—ã£ã¦ã„ã¾ã™ã€‚

https://docs.github.com/en/actions/using-workflows/using-github-cli-in-workflows

ãŸã ã— GitHub ä¸Šã§ secrets ãªç’°å¢ƒå¤‰æ•°ã‚’å®£è¨€ã™ã‚‹å ´åˆã€ `GITHUB_` ã‹ã‚‰å§‹ã¾ã‚‹ã‚‚ã®ãŒå®šç¾©ã§ãã¾ã›ã‚“ã€‚

ãã®ãŸã‚ã€ä»Šå›ã¯ `GH_TOKEN` ã¨ã„ã†åå‰ã§å®šç¾©ã—ã¾ã—ãŸã€‚

### GitHub CLI ã§ release ã‚’ä½œæˆã™ã‚‹

å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’è¦‹ã¾ã™ã€‚

https://cli.github.com/manual/gh_release_create

ã“ã®ã†ã¡ã€ `--generate-notes` ã‚’ä½¿ã†ã¨è‡ªå‹•çš„ã«ãƒªãƒªãƒ¼ã‚¹ãƒãƒ¼ãƒˆãŒä½œæˆã•ã‚Œã¾ã™ã€‚
çµæ§‹ã„ã„æ„Ÿã˜ã«ã§ãã‚‹ã®ã§ã€å€‹äººçš„ã«ã¯æ°—ã«å…¥ã£ã¦ã„ã¾ã™ã€‚

å…·ä½“çš„ã«ã¯ PR å˜ä½ã§ãƒ†ã‚­ã‚¹ãƒˆã‚’ã¾ã¨ã‚ã¦ãã‚Œã‚‹å½¢ã‹ãªï¼Ÿ ã¨æ€ã„ã¾ã™ã€‚

release ã‚’ä½œæˆã™ã‚‹éš›ã« tag ã‚‚è‡ªå‹•çš„ã«ä½œæˆã•ã‚Œã‚‹ã®ã§ã€ tag ãŒãªãã¦ã‚‚å®‰å¿ƒã§ã™ã€‚

ãŸã ã— tag ã«æ®‹ã£ã¦ã„ã‚‹æƒ…å ±ã¯è‡ªåˆ†ãŒè©¦ã—ã¦ã„ã‚‹é™ã‚Šã¯å¾®å¦™ã ã£ãŸã®ã§ã€å°‘ã—å·¥å¤«ãŒå¿…è¦ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ï¼ˆä¼¸ã³ã—ã‚ï¼‰

## æ„Ÿæƒ³

ä¹…ã€…ã« GitHub Actions ã‚’ä½¿ã£ãŸã‚‰ãƒ•ãƒƒã‚¯ã™ã‚‹ event ã‚’é–“é•ãˆã‚‹ãªã©æ€ã£ãŸã‚ˆã‚Šæ™‚é–“ãŒã‹ã‹ã£ã¦ã—ã¾ã„ã¾ã—ãŸã€‚
ã„ã„æ„Ÿã˜ã«å‹•ã„ãŸã®ã§å€‹äººçš„ã«ã¯æº€è¶³ã—ã¦ã„ã‚‹ã—ã€å°ã•ã GitHub Actions ã‚’å…¥ã‚Œã¦ã¿ã‚‹ã®ã§ã‚ã‚Œã°ã¡ã‚‡ã†ã©ã„ã„ã‚¿ã‚¹ã‚¯ãªã®ã‹ãªï¼Ÿ ã¨æ€ã„ã¾ã—ãŸã€‚

ã‚¿ã‚°ã«ã¤ã„ã¦ã„ã‚‹ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è‰¯ã„æ„Ÿã˜ã«ã™ã‚‹ã“ã¨ã¯æš‡ãªã¨ãã«ã§ã‚‚è€ƒãˆã¦ã¿ã‚ˆã†ã‹ã¨æ€ã„ã¾ã™ã€‚

