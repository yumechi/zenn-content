---
title: "Terraformに今更入門する"
emoji: "😸"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: ["terraform"]
published: false
---

CLI でクラウドにマシンなどを建てたいなーと思ったときに使える選択肢として Terraform があるなと思ったので、とりあえず触って見たメモ。

Terraform が何か、については IaC(Infrastructure as Code) を実現するためのツールの 1 つくらいの認識。

## 試してるリポジトリ

https://github.com/yumechi/terraform-suburi

## 環境

* Ubuntu 20.04 on WSL2
* terraform version は 0.14.3
* Windows build version は 2004、ビルド番号が 21277.1000 (Windows insider program の Dev チャンネルに合わせている)

## 公式サイト

https://www.terraform.io/

チュートリアルは下記。結構充実してそうなので、 AWS Get Started を進めてみる。

https://learn.hashicorp.com/terraform

## AWS Get Started やってみた

動画コンテンツもついてるけど、ドキュメントだけでも進めていけそうなので断片的にメモを取りながら。

### インストール

WSL2 の場合は Linux のインストール方法と同様になる。

なので GPG key を設定して、インストールする。インストールしたらとりあえず、 `-help plan` とか `-version` でも確認してみる。

```console
❯ terraform -version
Terraform v0.14.3
```

次に Docker を使って動かしてみる（この時まで Docker コンテナも作れるのを知らなかった）。

Docker Desktop for Windows が設定してあれば、チュートリアルどおりにコマンドを実行すれば動くはず。

チュートリアル通りやってもつまらないので、適当に ports の external を 8020 に変更した。

そのうえで `terraform init` し、 `terraform apply` したら、 `http://localhost:8020` をブラウザで見て nginx の表示画面が見れるはず。

`docker ps` で見ると nginx のコンテナが立っているのがわかるはず。

コンテナを止めるには `terraform destroy` を実行する。 destroy する前に `docker stop` とかでコンテナを止めてしまうと、エラー表示になるので注意。

terraform で操作したものは terraform でなんとかしましょうってことですね。

## AWS EC2を立ててみる

事前に AWS CLI の設定をしておく必要があります。自分は [99designs/aws-vault](https://github.com/99designs/aws-vault) を導入するときにいろいろやったので、用意済みでした。

これもチュートリアル通りに進めたが、 ami の設定値がよくわからないので調べてみると、 EC2 のインスタンスのイメージのことらしい（ami = Amazon Machine Image）。

下記のサイトを確認したところ、チュートリアルで指定されている ami が Ubuntu 16.04 だったので、 ap-northeast-1（東京リージョン）の Ubuntu 20.04 を指している `ami-0f2322bff98877761` に変更する。
ついでに region も `ap-northeast-1` に変更する。

https://cloud-images.ubuntu.com/locator/ec2/

その状態で `terraform init` と `terraform apply` を実行して EC2 の管理画面を表示したら無事にできていた。


